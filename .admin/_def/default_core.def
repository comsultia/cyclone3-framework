sub GetQuery
{
	my %form;
	my $name_value_pair;
	my @name_value_pairs=split('&',$ENV{'QUERY_STRING'}); # GET
	foreach $name_value_pair (@name_value_pairs)
	{
		my ($name,$value)=split('=',$name_value_pair);
		$value =~tr/+/ /;
		$value=~s/%([0-9A-Fa-f]{2})/pack("C",hex($1))/eg; # URL decode
		#$value =~s|\x7c|<--PIPE-->|g; # convert | to <--PIPE-->
		$form{$name}=$value;
	}

	my $ct=$ENV{CONTENT_TYPE};

	if ($ct=~/^multipart/)
	{
		$form{multipart}=$ct."<BR>";
		read(STDIN,my $buffer,$ENV{'CONTENT_LENGTH'}); # POST
		my $boundary;
		if ($ct=~/boundary=(.*)$/i){$boundary=$1;}
		$form{multipart}.="boundary:".$ct."<BR>";
		$form{multipart}.="boundary:".$boundary."<BR>";
		foreach my $parse(split /\r?\n?--$boundary-?-?\r\n/, $buffer)
		{
			my ($head,$data) = split (/\r\n\r\n/,$parse,2);
			$form{multipart}.="head:$head<BR>data:".length($data)."<BR>";
			if ($head=~/name="?(\w+)"?/i)
			{
				#if ($form{$1}[0]) # ak mam anonymne pole, predlzujem ho :)
				#{
					#push @{$form{$1}},$data;
				#}
				#els
				if ($form{$1}) # ak uz take data mam :))) vytvorim anonymne pole
				{
					#my $null=$form{$1};
					#push @{$form{$1}},$null;
					push @{$form{$1}},$data;
				}
				else
				{
					$form{$1}=$data;
					$form{$1}{head}=$head;
				}
			}
		}
	}
	else
	{
		read(STDIN,my $buffer,$ENV{'CONTENT_LENGTH'}); # POST
		@name_value_pairs=split('&',$buffer);
		foreach $name_value_pair (@name_value_pairs)
		{
			my ($name,$value)=split('=',$name_value_pair);
			$value =~ s/\+/ /g;
			$value=~s/%([0-9A-Fa-f]{2})/pack("C",hex($1))/eg;
			#$value =~s|\x7c|<--PIPE-->|g;
			$form{$name}=$value;
		}
	}
	return %form;
}

######################################################
# LOGGING                                                                             #
######################################################

sub save_log
{
	my ($depth,$text)=@_;
	$text=$ENV{'REMOTE_USER'}.":".$text;
	$main::DB{main}->Query("
		INSERT INTO _log (time,text,type,level)
		VALUES ('$current_time','$text','ADMN','$depth')
	");
		# return undef unless open (HND, ">>../_logs/".$Wyear.$Wmom.$Wmday."-".$$.".admnlog");
		# return undef unless print HND "\\".$$."\\".$fastcount."\\[".$depth."]\\ ".$text."\n";
		# close HND;
	return 1;
}

sub GetConf
{
	my $db_micro;
	my @db_micro_line;
	my %conf;
	my $WHAT=shift;
	$db_micro = $main::DB{main}->Query("
		SELECT variable,value
		FROM _config
		WHERE type='$WHAT'");
	while (@db_micro_line=$db_micro->FetchRow())
	{$conf{$db_micro_line[0]}=$db_micro_line[1]}
	return %conf;
}


sub convert_html
{
	my $full=shift;
	$full=~s|[\n\r]||g;
	$full=~s|<p>|<DIV>|gi;
	$full=~s|</p>|</DIV>|gi;
	$full=~s|<BR>|\n|gi;
	$full=~s|</DIV>$||gi;
	$full=~s|<DIV.*?>||gi;
	$full=~s|</DIV>|\n|gi;
	#$full=~s|<hr.*?paging.*?>|<myNEWPAGE>|gi;
	$full=~s|<hr paging='1' style='height:6px;background:blue;'>|<myNEWPAGE>|gi;
	$full=~s|<hr paging="1" style="height:6px;background:blue;">|<myNEWPAGE>|gi;
	$full=~s|<hr style='height:6px;background:blue;' paging='1'>|<myNEWPAGE>|gi;
	$full=~s|<hr style="height:6px;background:blue;" paging="1">|<myNEWPAGE>|gi;
	$full=~s|<hr style='background: blue; height: 6px' paging='1'>|<myNEWPAGE>|gi;
	$full=~s|<hr style="background: blue; height: 6px" paging="1">|<myNEWPAGE>|gi;
	return $full;
}


######################################################
# OVERALL DB NAMES AND PATHS DEFINITIONS                 #
######################################################
=head1
our $MAIN_db_name="webcom_sk";
our $MAIN_db_config="webcom_sk._config";

our $MAIN_db_a120="webcom_sk.a120";
our $MAIN_db_a120_category="webcom_sk.a120_category";

our $MAIN_db_a400="webcom_sk.a400";
our $MAIN_db_a400_attrs="webcom_sk.a400_attrs";
our $MAIN_db_a400_arch="webcom_sk.a400_arch";
our $MAIN_db_a400_attrs_arch="webcom_sk.a400_attrs_arch";
our $MAIN_db_a400_category="webcom_sk.a400_category";

our $MAIN_db_a410="TOM.Ca410";
our $MAIN_db_a410_category="TOM.Ca410_category";

our $MAIN_db_a500="webcom_sk.a500";
our $MAIN_db_a500_attrs="webcom_sk.a500_attrs";
our $MAIN_db_a500_category="webcom_sk.a500_category";

our $MAIN_path_a500="../!media/500";

our $MAIN_db_a820="forum_webcom_sk.a820";
=cut




1;
