sub BaseModul{
require "_table.m";
require "_info.m";

my $page_limit=20;
my $page_from=$page_limit*$form{page};
$form{page}="0" unless $form{page};

my $info=&info_create(
'icon'	=>	True,
'new'	=>	True,
'title'	=>	"Zoznam obrázkov index $form{where}",
'next'	=>	$form{page},
'prev'	=>	$form{page}
);

my $table=HP_TABLE->new(
'title'			=>	"Source",
'cellspacing'	=>	1,
'cellpadding'	=>	1,
'color_active'	=>	"#F0F0C0",
'link_core'		=>	"core.pl?type=$form{type}&",
'define'		=>
{
'1'	=>
	{
	'id'		=>	"náhľad",
	'select'	=>	"orderby=ID DESC",
	'class'		=>	"td_act",
	'code'		=>	"&nbsp;<a href=\"core.pl?type=500-edit&id=<!--ID-->\" target=\"frm_micro\"><img src=\"$tom::H_media/500/<!--NULLID-->-t.jpg\" width=40 height=40 border=1></a>&nbsp;",
	},
'2'	=>
	{
	'id'		=>	"formáty",
	'code'		=>	"&nbsp;<img src=\"$tom::H_media/grf/admin/list_<%1%>.gif\" width=11 height=12 border=0 align=absmiddle> -<%1-1%><BR>&nbsp;<img src=\"$tom::H_media/grf/admin/list_<%2%>.gif\" width=11 height=12 border=0 align=absmiddle> -<%2-1%><BR>&nbsp;<img src=\"$tom::H_media/grf/admin/list_<%3%>.gif\" width=11 height=12 border=0 align=absmiddle> -<%3-1%><BR>&nbsp;<img src=\"$tom::H_media/grf/admin/list_<%4%>.gif\" width=11 height=12 border=0 align=absmiddle> -<%4-1%><BR>",
	'td_plus'	=>	"nowrap style=\"FONT:bold 10px Verdana;\"",
	},
'3'	=>
	{
	'id'		=>	"info",
	'code'		=>	"&nbsp;ID: <B><!--ID--></B>&nbsp;<BR><BR>&nbsp;zdroj: <B><%2%></B><BR>&nbsp;vložil: <B><%3%></B><BR>",
	'td_plus'	=>	"nowrap",
	},
'3.1'	=>
	{
	'id'		=>	"alt",
	'code'		=>	"&nbsp;<%1%>&nbsp;<BR>",
	'td_plus'	=>	"style=\"width: 50%;\"",
	},
'3.2'	=>
	{
	'id'		=>	"keywords",
	'code'		=>	"&nbsp;<%1%>&nbsp;<BR>",
	#'td_plus'	=>	"style=\"FONT:10px Verdana;\"",
	},
'4'	=>
	{
	'id'		=>	"cF",
	'select'	=>	"orderby=ID DESC,IDcategory DESC",
	'class'		=>	"td_act",
	'code'		=>	"&nbsp;<a href=\"core.pl?type=500&wherelike=IDcategory&where=<!--IDCATEGORY-->&orderby=ID DESC,IDcategory ASC\" target=\"frm_base\"><img src=\"$tom::H_media/grf/admin/tree_0.gif\" border=0></a></a>&nbsp;",
	'td_plus'	=>	"valign=\"top\" nowrap style=\"FONT:bold 10px Verdana;\"",
	},
'5'	=>
	{
	'id'		=>	"cat",
	'select'	=>	"orderby=ID DESC,IDcategory DESC",
	'class'		=>	"td_act",
	'code'		=>	"&nbsp;<a href=\"core.pl?type=500&whereby=IDcategory&where=<!--IDCATEGORY-->&orderby=ID DESC,IDcategory ASC\" target=\"frm_base\"><b><%2%></b></a>&nbsp;",
	'td_plus'	=>	"valign=\"top\" nowrap style=\"FONT:bold 10px Verdana;\"",
	},
'99'	=>
	{
	'id'		=>	"X",
	'code'		=>	"<a href=\"core.pl?type=500-del&id=<!--ID-->\" target=\"frm_micro\"><img src=$tom::H_media/grf/admin/red_minus.gif border=0></a><BR>",
	'td_plus'	=>	"valign=\"top\" align=middle"
	}
}
);

#my $orderby="ORDER BY ID DESC";
my $orderby="ORDER BY ID DESC";
$orderby="ORDER BY $form{'orderby'}" if ($form{'orderby'});
my $where;
if ($form{'whereby'} eq "IDcategory"){$where="AND b.$form{whereby}='$form{where}'";}
elsif($form{'whereby'}){$where="AND a.$form{whereby}='$form{where}'";}
if ($form{'wherelike'}){$where="AND a.$form{wherelike} LIKE '$form{where}%'";}

my $select="SELECT DISTINCT a.ID,a.hash,a.format,a.size,b.IDcategory FROM $MAIN_db_a500 AS a,$MAIN_db_a500_attrs AS b WHERE a.ID=b.ID $where GROUP BY ID $orderby LIMIT $page_from,$page_limit";
my $db_micro = $dbh->Query($select);

#return $select;

my $prev_id;

#my $hoho;

while (my %db_micro_line=$db_micro->FetchHash())
{
 next if ($prev_id == $db_micro_line{ID});

 my $cl_t="r";
 my $cl_f="r";
 my $cl_s="r";
 my $cl_o="r";
 my $var;


 my $cl_class="tr1";
 my $cl_color="#8FADF9";
 my $nullid=sprintf('%07d',$db_micro_line{ID});
=head1
 my $db_micro1 = $dbh->Query("
 	SELECT ID,name
	FROM $MAIN_db_a500_category
	WHERE ID='$db_micro_line{IDcategory}' LIMIT 1");
 if (my @db_micro1_line=$db_micro1->FetchRow())
 {
  $cat_w=$db_micro1_line[1];
 }
=cut


 #my $cl_t="r";$cl_t="g" if (-e "../media/img/".$nullid."-t.jpg");
 #my $cl_s="r";$cl_s="g" if (-e "../media/img/".$nullid."-s.jpg");
 #my $cl_o="r";$cl_o="g" if (-e "../media/img/".$nullid."-o.jpg");

 my $db_micro1 = $dbh->Query("
	SELECT variable,value
	FROM $MAIN_db_config
	WHERE (variable='500-t_hash' OR variable='500-f_hash' OR variable='500-s_hash' OR variable='500-o_hash')");
 while (my @db_micro1_line=$db_micro1->FetchRow())
 {
   $db_micro_line{image_t_hash}=$db_micro1_line[1] if ($db_micro1_line[0] eq "500-t_hash");
   $db_micro_line{image_f_hash}=$db_micro1_line[1] if ($db_micro1_line[0] eq "500-f_hash");
   $db_micro_line{image_s_hash}=$db_micro1_line[1] if ($db_micro1_line[0] eq "500-s_hash");
   $db_micro_line{image_o_hash}=$db_micro1_line[1] if ($db_micro1_line[0] eq "500-o_hash");
 }

 #return $db_micro_line{image_m_hash}.",".$db_micro_line{image_t_hash}.",".$db_micro_line{image_s_hash}.",".$db_micro_line{image_o_hash};

 $nullid=~/^(....)/i;
 my $var=$1;
 #return $var;

 $db_micro1 = $dbh->Query("
	SELECT ID,hash,format
	FROM $MAIN_db_a500
	WHERE ID='$db_micro_line{ID}'");
#return "
#	SELECT ID,hash,format
#	FROM $MAIN_db_a500
#	WHERE ID='$db_micro_line{ID}'";
 #return $db_micro_line{image_m_hash}.",".$db_micro_line{image_t_hash}.",".$db_micro_line{image_s_hash}.",".$db_micro_line{image_o_hash};

#return $db_micro_line{image_m}.",".$db_micro_line{image_t}.",".$db_micro_line{image_s}.",".$db_micro_line{image_o};

 while (@db_micro1_line=$db_micro1->FetchRow())
 {
  if ($db_micro_line{'image_'.$db_micro1_line[2].'_hash'} eq "1") {$db_micro_line{'image_'.$db_micro1_line[2]}=$db_micro1_line[1];} else {$db_micro_line{'image_'.$db_micro1_line[2]}=$db_micro1_line[0];}
  $cl_t="g" if ($db_micro1_line[2] eq "t");
  $cl_f="g" if ($db_micro1_line[2] eq "f");
  $cl_s="g" if ($db_micro1_line[2] eq "s");
  $cl_o="g" if ($db_micro1_line[2] eq "o");
  #$hoho.=$cl_m.",".$cl_t.",".$cl_s.",".$cl_o."<br />";
 }

 my $cl_t_size=int((-s "../500/".$db_micro_line{image_m}."-t.jpg")/1024);
 my $cl_f_size=int((-s "../500/".$db_micro_line{image_t}."-f.jpg")/1024);
 my $cl_s_size=int((-s "../500/".$db_micro_line{image_s}."-s.jpg")/1024);
 my $cl_o_size=int((-s "../500/".$db_micro_line{image_o}."-o.jpg")/1024);

# my $cat_w=$db_micro_line[1]." ";
# my $cat_s;
# while (($cat_w)&&($cat_w=~s|.?$||))
# {$cat_s.=" OR ID='$cat_w'";}
# $cat_s=~s|^ OR ||g;$cat_s=~s| OR ID=''$||g;
# my @cat_select;
# my $cat_limit=length($db_micro_line[1]);
# my $db_micro1 = $dbh->Query("
# 	SELECT ID,tinyname
#	FROM photogallery_cathegory
#	WHERE $cat_s LIMIT $cat_limit");
# while (my @db_micro1_line=$db_micro1->FetchRow())
# {
#  my $pos=length($db_micro1_line[0]);
#  $cat_select[$pos-1]=$db_micro1_line[1];
# }
# $cat_w=join "/",@cat_select;


 my $db_micro1 = $dbh->Query("
 	SELECT about,keywords,IDauthor,IDcategory
	FROM $MAIN_db_a500_attrs
	WHERE ID='$db_micro_line{ID}' LIMIT 1");
 if (my @db_micro1_line=$db_micro1->FetchRow())
 {
  $db_micro_line{about}=$db_micro1_line[0];
  $db_micro_line{keywords}=$db_micro1_line[1];
  $db_micro_line{IDauthor}=$db_micro1_line[2];
  $db_micro_line{IDcategory}=$db_micro1_line[3];
 }

 my $cat_w;
 my $db_micro1 = $dbh->Query("
 	SELECT ID,name
	FROM $MAIN_db_a500_category
	WHERE ID='$db_micro_line{IDcategory}' LIMIT 1");
 if (my @db_micro1_line=$db_micro1->FetchRow())
 {
  $cat_w=$db_micro1_line[1];
 }




 my $db_micro1 = $dbh->Query("SELECT ID,fullname FROM $MAIN_db_a120 WHERE ID='$db_micro_line{IDauthor}' OR ID='$db_micro_line{IDeditor}' LIMIT 1");
 if (my @db_micro1_line=$db_micro1->FetchRow())
 {
  if ($db_micro_line{IDauthor} eq $db_micro1_line[0]) { $db_micro_line{author}=$db_micro1_line[1]; }
  if ($db_micro_line{IDeditor} eq $db_micro1_line[0]) { $db_micro_line{editor}=$db_micro1_line[1]; }
 }


$table->add(
'class'		=>	$cl_class,
'color'		=>	$cl_color,
'define'	=>{

'formáty'	=>
{
	'1'		=>	$cl_t,
	'1-1'	=>	$cl_t_size."Kb - 40x40",
	'2'		=>	$cl_f,
	'2-1'	=>	$cl_f_size."Kb - 80x80",
	'3'		=>	$cl_s,
	'3-1'	=>	$cl_t_size."Kb - 260x180",
	'4'		=>	$cl_o,
	'4-1'	=>	$cl_o_size."Kb - ".$db_micro_line{size},
},

'X'	=>
{'1'=>""},

'info'	=>
{'2'=>$db_micro_line{author},'3'=>$db_micro_line{editor}},

'alt'	=>
{'1'=>$db_micro_line{about}},

'keywords'	=>
{'1'=>$db_micro_line{keywords}},

'cF'	=>
{'2'=>$cat_w},

'cat'	=>
{'2'=>$cat_w},

},'replace'=>{'NULLID'=>$var."/".$db_micro_line{image_t},'ID'=>$db_micro_line{ID}, 'IDCATEGORY' => $db_micro_line{IDcategory}});

}
#return $hoho;
return $info.$table->HTML;}













1;
