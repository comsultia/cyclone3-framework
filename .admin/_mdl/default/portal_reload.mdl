sub BaseModul
{
my $id=$form{id};
if ($form{set})
{
# $HTML_HEADER{BODY}{extract}="yes";
 $form{year1}-=1900;
 $form{mom1}--;
 my $starttime=timelocal(undef,$form{min1},$form{hour1},$form{day1},$form{mom1},$form{year1},undef,undef,undef);
 
 for (my $i=0;$i<=6;$i++)
 {
  if ($form{'cache_'.$i})
  {
  
  
   my $db_micro = $dbh->Query("
 	SELECT value 
	FROM _config
	WHERE variable='cache_reload_$i'
		AND type='PRTL'
	LIMIT 1");
	 if (my @db_micro_line=$db_micro->FetchRow())
	 {
	  &save_log(0,"reload cache portalu $i");
	  $dbh->Query("
	  	UPDATE _config 
		SET value='$starttime' 
		WHERE variable='cache_reload_$i'
			AND type='PRTL'
		LIMIT 1");
	 }
	 else
	 {
	   &save_log(0,"Writing reload of cache of portal $i");
	   $dbh->Query("
	  	INSERT INTO _config(variable,value,type)
		VALUES('cache_reload_$i','$starttime','PRTL')");
	 }
  
  
  }
 }
 
 
  if ($form{'restart'})
  {  
   my $db_micro = $dbh->Query("
 	SELECT value 
	FROM _config
	WHERE variable='fastcgi_reload'
		AND type='PRTL'
	LIMIT 1");
	 if (my @db_micro_line=$db_micro->FetchRow())
	 {
	  &save_log(0,"portal restart");
	  $dbh->Query("
	  	UPDATE _config 
		SET value='$starttime' 
		WHERE variable='fastcgi_reload'
			AND type='PRTL'
		LIMIT 1");
	 }
	 else
	 {
	  &save_log(0,"writing restart of portal");
	   $dbh->Query("
	  	INSERT INTO _config(variable,value,type)
		VALUES('fastcgi_reload','$starttime','PRTL')");
	 }  
  }
 
 
 
# $dbh->Query("UPDATE sutaz SET starttime='$starttime',endtime='$endtime',tiny='$tiny',full='$full' WHERE ID='$id' LIMIT 1");

}
else
{
 $HTML_HEADER{BODY}{extract}="yes";
 $HTML_HEADER{BODY}{onunload}="parent.box_loading.style.display='block';";

 (undef,$minR1,$hourR1,$mdayR1,$momR1,$yearR1,undef,undef,undef) = localtime($current_time);
 $momR1++;$yearR1=$yearR1+1900;
 
 my $mdl_temp=<<"HEADER";
<table width=100% cellspacing=0 cellpadding=0 border=0><tr><td drag_here>
<form name="$form{type}\_$id"  
action="core.pl?type=$form{type}&set=yes" target="frm_micro" method="POST">
</td><td width=100% style="FONT:10px Verdana;">

<table width=100% height=50 cellspacing=0 cellpadding=0 border=0>
<tr>
<td bgcolor=red style="FONT:bold 10px Verdana;COLOR:white" align=middle>
CAUTION!!! READ THIS!!!<BR>
This function allows to partial or full reload of portalu if it is needed to execute changes immediately and show them on portal.<BR>
</td>
</tr>
</table>

<table height=16 width=100% cellspacing=0 cellpadding=0 border=0 background="$h_grf/admin/win_top_0_back.gif"><tr><td></td></tr></table>	

<table width=100% cellspacing=2 cellpadding=0 border=0><tr><td width=50% style="FONT:bold 12px Verdana;">Timing:</td>

HEADER

 
 my $width0=30-12;
 my $width1=50-12;
 
 my $mdl_micro;
 for (my $i=1;$i<=31;$i++)
 {
  $mdl_micro.="<div onclick=\"this.parentElement.parentElement.all['VALUE'].value='$i';\">&nbsp;$i</div>\n";
 }
 $mdl_temp.="<td>".&select_create(
 	'name'		=>	"day1",
	'value'		=>	$mdayR1,
	'maxlength'	=>	30,
	'width'		=>	$width0,
	'width1'	=>	50,
	'select'	=>	$mdl_micro
 )."</td>";
 
 
 my $mdl_micro;
 @mesiac=("january","february","march","april","may","june","july","august","september","october","november","december");
 for (my $i=1;$i<=12;$i++)
 {
  $mdl_micro.="<div onclick=\"this.parentElement.parentElement.all['VALUE'].value='$i';\">&nbsp;$i-$mesiac[$i-1]</div>\n";
 }
 $mdl_temp.="<td>".&select_create(
 	'name'		=>	"mom1",
	'value'		=>	$momR1,
	'maxlength'	=>	30,
	'width'		=>	$width0,
	'width1'	=>	90,
	'select'	=>	$mdl_micro
 )."</td>";
 
 
 
 my $mdl_micro;
 for (my $i=2000;$i<=2050;$i++)
 {
  $mdl_micro.="<div onclick=\"this.parentElement.parentElement.all['VALUE'].value='$i';\">&nbsp;$i</div>\n";
 }
 $mdl_temp.="<td>".&select_create(
 	'name'		=>	"year1",
	'value'		=>	$yearR1,
	'maxlength'	=>	30,
	'width'		=>	$width1,
	'width1'	=>	50,
	'select'	=>	$mdl_micro
 )."</td>"; 
 
 
 $mdl_temp.="<td>&nbsp;</td>";
 
 
  my $mdl_micro;
 for (my $i=0;$i<=23;$i++)
 {
  $mdl_micro.="<div onclick=\"this.parentElement.parentElement.all['VALUE'].value='$i';\">&nbsp;$i</div>\n";
 }
 $mdl_temp.="<td>".&select_create(
 	'name'		=>	"hour1",
	'value'		=>	$hourR1,
	'maxlength'	=>	30,
	'width'		=>	$width0,
	'width1'	=>	50,
	'select'	=>	$mdl_micro
 )."</td>"; 
 
  $mdl_temp.="<td>:</td>";
 
  my $mdl_micro;
 for (my $i=0;$i<=55;$i=$i+5)
 {
  $mdl_micro.="<div onclick=\"this.parentElement.parentElement.all['VALUE'].value='$i';\">&nbsp;$i</div>\n";
 }
 $mdl_temp.="<td>".&select_create(
 	'name'		=>	"min1",
	'value'		=>	$minR1,
	'maxlength'	=>	30,
	'width'		=>	$width0,
	'width1'	=>	50,
	'select'	=>	$mdl_micro
 )."</td>"; 
 
 
 $mdl_temp.="<td width=50%></td></tr></table>";
 
  
 $mdl_temp.=<<"HEADER";

<table height=16 width=100% cellspacing=0 cellpadding=0 border=0 background="$h_grf/admin/win_top_0_back.gif"><tr><td></td></tr></table>	

<div style="FONT:12px Verdana;">

<input name="restart" type=checkbox align=absmiddle>&nbsp;RESTART PORTAL (cautious!!!)<BR>
<input name="cache_0" type=checkbox align=absmiddle>&nbsp;0 : <B>Design</B><BR>
<input name="cache_1" type=checkbox align=absmiddle>&nbsp;1 : <B>Imports</B> (chat,zoznamka,...)<BR>
<input name="cache_2" type=checkbox align=absmiddle>&nbsp;2 : <B>Banners</B><BR>
<input name="cache_3" type=checkbox align=absmiddle>&nbsp;3 : <B>Hard box</B> (categories,...)<BR>
<input name="cache_4" type=checkbox align=absmiddle>&nbsp;4 : <B>Soft box</B> (s˙ùaûe, hlasovanie,...)<BR>
<input name="cache_5" type=checkbox align=absmiddle>&nbsp;5 : <B>Statistics</B> (most viewed,...)</B><BR>
<input name="cache_6" type=checkbox align=absmiddle checked>&nbsp;6 : <B>VirtuaNews</B> (TOP pages,...)</B><BR>
	
</div>
		
<table height=16 width=100% cellspacing=0 cellpadding=0 border=0 background="$h_grf/admin/win_top_0_back.gif"><tr><td width=50% align=right><img src="$h_grf/admin/win_top_0_del.gif" border=0><BR></td><td><center><input type=submit drag_here value="EXECUTE!" class=btn0 onclick="box_erase2();"></center></td><td align=left width=50%><img src="$h_grf/admin/win_top_0_del.gif" border=0><BR></td></tr></table>	
	
HEADER
 
 
 $mdl_temp.="</td><td></form></td></tr></table>";
 
 my $box=&box_create2("PORTAL RELOAD",
	'color_base0'	=>	"#0B63F1",
	'width'			=>	300,
	'height'		=>	50,	
	'close'			=>	"yes",
	'html'			=>	$mdl_temp);

 return $box;
 
 return undef;
}
}


1;