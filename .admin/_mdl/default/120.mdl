sub BaseModul
{
 require "_table.m";
 require "_info.m";

 my $page_limit=20;
 my $page_from=$page_limit*$form{page};
 $form{page}="0" unless $form{page};

 my $info=&info_create(
	'icon'	=>	"style=\"cursor:hand;\" onclick=\"load_box('core.pl?type=clanok_search');\"",
	'new'	=>	True,
	'title'	=>	"Sources listing",
	'next'	=>	$form{page},
	'prev'	=>	$form{page}
 );
 my $select;

 for (my $i=0;$i<=55;$i=$i+5)
 {
  $select.="<div onclick=\"this.parentElement.parentElement.all['VALUE'].value='$i';\">&nbsp;$i</div>\n";
 }
 my $select_author=&select_create(
	'name'		=>	"min2",
	'value'		=>	$minR2,
	'maxlength'	=>	30,
	'width'		=>	1,
	'width1'	=>	50,
	'select'	=>	$select
 );




 my $table=HP_TABLE->new(
 'title'			=>	"taky maly popis",
 'cellspacing'	=>	1,
 'cellpadding'	=>	1,
 #'color_active'	=>	"#F0F080",
 'color_active'	=>	"#F0F0C0",
 'link_core'		=>	"core.pl?type=$form{type}&",
 'define'		=>
 {
 '1'	=>
	{
	'id'		=>	"A",
	'code'		=>	"<img src=\"$tom::H_media/grf/admin/list_<%1%>.gif\" width=11 height=12 border=0 onclick=\"this.src='core.pl?type=set_active&table=a120&id=<!--ID-->';\">",
	'select'	=>	"orderby=active",
	'class'		=>	"td_act",
	'td_class'	=>	"td_act"
	},
 '2'	=>
	{
	'id'		=>	"cat",
	'code'		=>	"<%1%>",
	'select'	=>	"orderby=IDcategory",
	'class'		=>	"td_act",
	'td_plus'	=>	"nowrap"
	},
 '3'	=>
	{
	'id'		=>	"type",
	'code'		=>	"<%1%>",
	'select'	=>	"orderby=type",
	'class'		=>	"td_act",
	'td_plus'	=>	"nowrap"
	},
 '4'	=>
	{
	'id'		=>	"nickname",
	'code'		=>	"&nbsp;<B><%1%></B>",
	'select'	=>	"orderby=nickname",
	'class'		=>	"td_act",
	'td_class'	=>	"td0",
	'td_plus'	=>	"nowrap"
	},
 '5'	=>
	{
	'id'		=>	"fullname",
	'code'		=>	"&nbsp;<b><%1%></b>",
	'select'	=>	"orderby=fullname",
	'class'		=>	"td_act",
	'td_class'	=>	"td0",
	'td_plus'	=>	"nowrap"
	},
 }
 );
 my $where;
 $where="WHERE $form{whereby}='$form{where}'" if ($form{'whereby'});
 $where="WHERE $form{wherelike} LIKE '%$form{where}%'" if ($form{'wherelike'});

 my $orderby;
 if ($form{'orderby'}) { $orderby=$form{'orderby'}; } else { $orderby="IDcategory"; }

 #my $db_micro = $dbh->Query("SELECT ID, priority, starttime, endtime, updated, title, IDcathegory, typeview, visits_index, visits, absvisits_index, visits_index, votes, vote_full, vote_index, votes, image, data_plus, active  FROM clanky_trash $where $orderby LIMIT $page_from,$page_limit");

#return "SELECT ID, active, IDcategory, IDtype, nickname, fullname, xdata FROM markiza_sk.a120 $where ORDER BY $orderby ASC LIMIT $page_from,$page_limit";

 $db_micro = $dbh->Query("SELECT ID, active, IDcategory, IDtype, nickname, fullname, xdata FROM markiza_sk.a120 $where ORDER BY $orderby ASC LIMIT $page_from,$page_limit");

 while (my %db_micro_line=$db_micro->FetchHash())
 {
  #active
  my $cl_active="r";
  if ($db_micro_line{'active'} eq "Y"){$cl_active="g"}
  use Utils::datetime;
  #today, yesterday, older line color
  my $cl_color="#8FADF9";
  if ($db_micro_line{starttime}>(time-86400)){$cl_color="#B0CFFF"}
  if ($db_micro_line{starttime}>time){$cl_color="#E0EFFF"}

  my $cl_class="tr1";
  my %article_times;

  $article_times{'starttime'}={Utils::datetime::ctodatetime($db_micro_line{'starttime'},format=>1)};
  $article_times{'endtime'}={Utils::datetime::ctodatetime($db_micro_line{'endtime'},format=>1)};
  $article_times{'changetime'}={Utils::datetime::ctodatetime($db_micro_line{'changetime'},format=>1)};
  #my $article_times{'lasttime'}=Utils::datetime::ctodatetime($db_micro_line{'lasttime'},format=>1);

  #my $db_micro2=$dbh->Query("SELECT ID, nickname FROM markiza_sk.a120 WHERE ID='$db_micro_line{'IDauthor'}' LIMIT 1");
  #my @db_micro_line2=$db_micro2->FetchRow();
  #$db_micro_line{'author_name'}=$db_micro_line2[1];

  #my $db_micro2=$dbh->Query("SELECT ID, name FROM markiza_sk.a400_category WHERE ID='$db_micro_line{'IDcategory'}' LIMIT 1");
  #my @db_micro_line2=$db_micro2->FetchRow();
  #$db_micro_line{'cat_name'}=$db_micro_line2[1];

  undef @db_micro2;
  undef @db_micro_line2;

  #return "SELECT id, nickname, fullname FROM markiza_sk.a120 WHERE ID='$db_micro_line{ID}' LIMIT 1";

  my $db_micro2=$dbh->Query("SELECT id, nickname, fullname FROM markiza_sk.a120 WHERE ID='$db_micro_line{ID}' LIMIT 1");
  my @db_micro_line2=$db_micro2->FetchRow();
  $db_micro_line{'nickname'}=$db_micro_line2[1];
  $db_micro_line{'fullname'}=$db_micro_line2[2];


  $table->add(
   'class'		=>	$cl_class,
   'color'		=>	$cl_color,
   'define'	=>{

    'A'	=>
    {	'1'	=>	$cl_active},

    'cat'	=>
    {'1'=>"<a href=\"core.pl?type=articles&whereby=IDcategory&where=$db_micro_line{'IDcategory'}\" target=\"frm_base\">".$db_micro_line{'cat_name'}."</a>"},

    'type'	=>
    {'1'=>$db_micro_line{'type_name'}},

    'nickname'	=>
    {'1'=>"<a href=\"javascript:load_box('core.pl?type=120-edit&id=".$db_micro_line{'ID'}."')\">".$db_micro_line{'nickname'}."</a>"},

    'fullname'	=>
    {'1'=>$db_micro_line{'fullname'}},

    #'Vi'	=>
    #{'1'=>"$db_micro_line{'visits'}"},
    #{'1'=>"<a href=\"core.pl?type=articles&orderby=visits\" target=\"frm_base\">".$db_micro_line{'visits'}."</a>"},

#    'Y'	=>
#    {'1'=>"<a href=\"core.pl?type=clanok_undele&id=<!--ID-->\" target=\"frm_micro\"><img src=$tom::H_media/grf/admin/close3.gif border=0 width=12 height=12></a>"},

#    'X'	=>
#    {'1'=>"<a href=\"core.pl?type=clanok_trashdel&id=<!--ID-->\" target=\"frm_micro\"><img src=$tom::H_media/grf/admin/close1.gif border=0 width=12 height=12></a>"},

   },'replace'	=>{'ID'	=>	$db_micro_line[0]}
  );
 }
 return $info.$table->HTML;
}

1;
