sub BaseModul
{
# $HTML_HEADER{BODY}{extract}="yes";
 if ($form{archive} eq "Y") { $form{table}="a400_arch"; } else { $form{table}="a400"; }

 $transferResult="1";

 my $id=$form{id};
 $db_micro = $dbh->Query("SELECT * FROM $MAIN_db_name.$form{table} WHERE ID='$id' LIMIT 1");
 if (%db_micro_line=$db_micro->FetchHash())
 {
  if ($db_micro_line{arch} eq "Y")
  {
   #&save_log(1,"dearchiving markiza_sk.$form{table} id=$id");

=head1
   $transferResult="INSERT INTO markiza_sk.a400
   (
   ID,
   IDattrs,
   starttime,
   endtime,
   changetime,
   lasttime,
   title,
   subtitle,
   tiny,
   full,
   IDauthor,
   IDeditor,
   IDcategory,
   xdata,
   xrelated,
   link,
   priority,
   visits,
   lng,
   active,
   arch)
   VALUES (
   '$db_micro_line{ID}',
   '$db_micro_line{IDattrs}',
   '".time."',
   '$db_micro_line{endtime}',
   '$db_micro_line{changetime}',
   '$db_micro_line{lasttime}',
   '$db_micro_line{title}',
   '$db_micro_line{subtitle}',
   '$db_micro_line{tiny}',
   '$db_micro_line{full}',
   '$db_micro_line{IDauthor}',
   '$db_micro_line{IDeditor}',
   '$db_micro_line{IDcategory}',
   '$db_micro_line{xdata}',
   '$db_micro_line{xrelated}',
   '$db_micro_line{link}',
   '$db_micro_line{priority}',
   '$db_micro_line{visits}',
   '$db_micro_line{lng}',
   '$db_micro_line{active}',
   'N')";

  $HTML_HEADER{BODY}{extract}="yes";

  my $box=&article_box_create("SQL syntax",
	'color_base0'	=>	"#0B63F1",
	'width'			=>	200,
	'height'		=>	50,
	'close'			=>	"yes",
	'html'			=>	$transferResult,);

  return $box;
=cut

   $db_micro_line{full}=~s|'|\\'|g;
   $db_micro_line{tiny}=~s|'|\\'|g;
   $db_micro_line{title}=~s|'|\\'|g;
   $db_micro_line{subtitle}=~s|'|\\'|g;

   if ($dbh->Query("INSERT INTO $MAIN_db_a400
   (
   ID,
   IDattrs,
   starttime,
   endtime,
   changetime,
   lasttime,
   title,
   subtitle,
   tiny,
   full,
   IDauthor,
   IDeditor,
   IDcategory,
   xdata,
   xrelated,
   link,
   priority,
   visits,
   lng,
   active,
   arch)
   VALUES (
   '$db_micro_line{ID}',
   '$db_micro_line{IDattrs}',
   '".time."',
   '$db_micro_line{endtime}',
   '$db_micro_line{changetime}',
   '$db_micro_line{lasttime}',
   '$db_micro_line{title}',
   '$db_micro_line{subtitle}',
   '$db_micro_line{tiny}',
   '$db_micro_line{full}',
   '$db_micro_line{IDauthor}',
   '$db_micro_line{IDeditor}',
   '$db_micro_line{IDcategory}',
   '$db_micro_line{xdata}',
   '$db_micro_line{xrelated}',
   '$db_micro_line{link}',
   '$db_micro_line{priority}',
   '$db_micro_line{visits}',
   '$db_micro_line{lng}',
   '$db_micro_line{active}',
   'N')"))
   {
    my $visitsCounter="0";

    $db_micro1 = $dbh->Query("SELECT IDattrs,visits_index7day FROM $MAIN_db_a400_attrs_arch WHERE IDattrs='$db_micro_line{IDattrs}'");
    if (@db_micro1_line=$db_micro1->FetchRow())
    { $visitsCounter=$db_micro1_line[1]; }
    else
    { $dbh->Query("INSERT INTO $MAIN_db_a400_attrs_arch (IDattrs,visits_index7day) VALUES ($db_micro_line{IDattrs},0)"); }

    $dbh->Query("DELETE FROM $MAIN_db_a400_arch WHERE ID='$db_micro_line{ID}' LIMIT 1");

    $dbh->Query("INSERT INTO $MAIN_db_a400_attrs (IDattrs,visits_index7day) VALUES ($db_micro_line{IDattrs},$visitsCounter)");

    $db_micro1 = $dbh->Query("SELECT ID FROM $MAIN_db_a400_arch WHERE IDattrs='$db_micro_line{IDattrs}'");
    if (@db_micro1_line=$db_micro1->FetchRow())
    {}
    else
    { $dbh->Query("DELETE FROM $MAIN_db_a400_attrs_arch WHERE IDattrs='$db_micro_line{IDattrs}' LIMIT 1"); }
   }
   else
   { $transferResult="Neuspesny presun clanku medzi aktivne! NEpokracujem s odstranovanim z archivnych clankov."; }
  }
  else
  {
   #&save_log(1,"archiving markiza_sk.$form{table} id=$id");

   if ($dbh->Query("INSERT INTO $MAIN_db_a400_arch
   (
   ID,
   IDattrs,
   starttime,
   endtime,
   changetime,
   lasttime,
   title,
   subtitle,
   tiny,
   full,
   IDauthor,
   IDeditor,
   IDcategory,
   xdata,
   xrelated,
   link,
   priority,
   visits,
   lng,
   active,
   arch)
   VALUES (
   '$db_micro_line{ID}',
   '$db_micro_line{IDattrs}',
   '$db_micro_line{starttime}',
   '$db_micro_line{endtime}',
   '$db_micro_line{changetime}',
   '$db_micro_line{lasttime}',
   '$db_micro_line{title}',
   '$db_micro_line{subtitle}',
   '$db_micro_line{tiny}',
   '$db_micro_line{full}',
   '$db_micro_line{IDauthor}',
   '$db_micro_line{IDeditor}',
   '$db_micro_line{IDcategory}',
   '$db_micro_line{xdata}',
   '$db_micro_line{xrelated}',
   '$db_micro_line{link}',
   '$db_micro_line{priority}',
   '$db_micro_line{visits}',
   '$db_micro_line{lng}',
   '$db_micro_line{active}',
   'Y')"))
   {
    my $visitsCounter="0";

    $db_micro1 = $dbh->Query("SELECT IDattrs,visits_index7day FROM $MAIN_db_a400_attrs WHERE IDattrs='$db_micro_line{IDattrs}'");
    if (@db_micro1_line=$db_micro1->FetchRow())
    { $visitsCounter=$db_micro1_line[1]; }
    else
    { $dbh->Query("INSERT INTO $MAIN_db_a400_attrs (IDattrs,visits_index7day) VALUES ($db_micro_line{IDattrs},0)"); }

    $dbh->Query("DELETE FROM $MAIN_db_a400 WHERE ID='$db_micro_line{ID}' LIMIT 1");

    $dbh->Query("INSERT INTO $MAIN_db_a400_attrs_arch (IDattrs,visits_index7day) VALUES ($db_micro_line{IDattrs},$visitsCounter)");

    $db_micro1 = $dbh->Query("SELECT ID FROM $MAIN_db_a400 WHERE IDattrs='$db_micro_line{IDattrs}'");
    if (@db_micro1_line=$db_micro1->FetchRow())
    {}
    else
    { $dbh->Query("DELETE FROM $MAIN_db_a400_attrs WHERE IDattrs='$db_micro_line{IDattrs}' LIMIT 1"); }
   }
   else
   { $transferResult="Neuspesny presun clanku do archivu! NEpokracujem s odstranovanim z aktivnych clankov."; }
  }
#  {
#   &save_log(1,"archiving markiza_sk.$form{table} id=$id");
#   $dbh->Query("UPDATE markiza_sk.$form{table} SET arch='Y' WHERE ID='$id' LIMIT 1");
#
#  }
 }
 else
 {
  #&save_log(1,"failed to change activation in markiza_sk.$form{table} id=$id");
  #print "Location: $tom::H_media/grf/admin/list_y.gif\n\n";
#	$mdl_temp.="none";
  $transferResult="Clanok, ktory sa snazite presunut, uz NEexistuje!";
 }

 if ($transferResult ne "1")
 {
  $HTML_HEADER{BODY}{extract}="yes";

  my $box=&article_box_create("Chyba pri presune!",
	'color_base0'	=>	"#0B63F1",
	'width'			=>	200,
	'height'		=>	50,
	'close'			=>	"yes",
	'html'			=>	$transferResult,);

  return $box;
 }

 return "<script>parent.document.frames['frm_base'].location.reload();</script>";
}













1;
