sub BaseModul
{
 my $id;
 $id=$form{id} if ($form{id});
 my $indexes;

 $HTML_HEADER{BODY}{extract}="yes";

 if ($form{set})
 {
  my $FORUM;
  if ($form{id})
  {
   $dbh->query("UPDATE forum_markiza_sk.a820 SET name='$form{name}',about='$form{about}' WHERE ID='$id'");
  }
  else
  {
    our @WCHAR=qw/0 1 2 3 4 5 6 7 8 9 A B C D E F G H I J K L M N O P Q R S T U V W X Y Z a b c d e f g h i j k l m n o p q r s t u v w x y z/;
    #article forum does not exist, probably adding a new article; inserting a new article forum, inserting into xrelated of the article
    $db_micro1 = $dbh->Query("SELECT DISTINCT ID FROM forum_markiza_sk.a820 WHERE ID LIKE '00a002%' AND type='F' GROUP BY ID ORDER BY ID ASC");
    while (@db_micro1_line=$db_micro1->FetchRow())
    {
     $FORUM=sprintf("00a002%1s%1s%1s",$WCHAR[$q1],$WCHAR[$q2],$WCHAR[$q3]);

	$q3++;
	if ($q3>61)
	{
		$q3=0;
		$q2++;
		if ($q2>61)
		{
			$q2=0;
			$q1++;
		}
	}
     if ($FORUM ne $db_micro1_line[0]) {$id=$FORUM; last; }
    }

    if ($id eq "")
    {
     $id=sprintf("00a002%1s%1s%1s",$WCHAR[$q1],$WCHAR[$q2],$WCHAR[$q3]);
    }



  #return "INSERT INTO forum_markiza_sk.a820 (ID,createtime,name,about,type,active) VALUES ('$id', '".time."', '$form{name}', '$form{about}', '$form{fullname}', 'F', 'N');";

   $db_micro = $dbh->query("SELECT IDattrs FROM forum_markiza_sk.a820_attrs ORDER BY IDattrs DESC LIMIT 1;");
   if (@db_micro_line = $db_micro -> FetchRow())
   {
	$db_micro_line[0]++;
	$dbh->query("INSERT INTO forum_markiza_sk.a820_attrs (IDattrs) VALUES ('$db_micro_line[0]');");
     $dbh->query("INSERT INTO forum_markiza_sk.a820 (ID,IDattrs,createtime,name,about,type,active) VALUES ('$id', '$db_micro_line[0]', '".time."', '$form{name}', '$form{about}', 'F', 'N');");
   }
  }
  return "\n<script>\nparent.document.frames['frm_base'].location.reload();\n</script>";
 }
 else #tu je ten predel dopice tam!!!------------------------------------------------------------------------------------------------------
 {
  #$HTML_HEADER{BODY}{onunload}="parent.box_loading.style.display='block';";

  my %db_micro_line;

  if ($form{id})
  {
   $db_micro = $dbh->Query("SELECT * FROM forum_markiza_sk.a820 WHERE ID='$id'");
   %db_micro_line=$db_micro->FetchHash();
  }


########for testing purposes .. targeting into the same frame
#<form name="articleEdit\_$id" action="core.pl?type=020-insert&set=yes" method="POST" enctype="multipart/x-form-data" target="frm_micro">

  my $mdl_temp=<<"HEADER";
  <form name="themeEdit\_$id" action="core.pl?type=820-themes-edit&set=yes&id=$id" method="POST" target="frm_micro" style="display: inline;">
  <table width=100% cellspacing=0 cellpadding=0 border=0><tr><td width=100% style="FONT:10px Verdana;COLOR:white;">
  &nbsp;Názov tematického fóra:<BR>
  <input type=text name="name" value="$db_micro_line{name}" class=input0 maxlength=100 style="FONT:9px Verdana;width:100%;">
  &nbsp;Popis:<BR>
  <textarea name="about" rows="5" class=input0 style="FONT:9px Verdana;width:100%;">$db_micro_line{about}</textarea>
  </td></tr></table>
  <table height=16 width=100% cellspacing=0 cellpadding=0 border=0 background="$tom::H_media/grf/admin/win_top_0_back.gif"><tr><td width=50% align=right><img src="$tom::H_media/grf/admin/win_top_0_del.gif" border=0><BR></td><td><center><input type=submit drag_here value="Uložiť!" class=btn0 onclick="box_erase2();"></center></td><td align=left width=50%><img src="$tom::H_media/grf/admin/win_top_0_del.gif" border=0><BR></td></tr></table></form>
HEADER

  $mdl_temp.="</td></tr></table>";

  my $box=&article_box_create("Vloženie/Úprava témy",
	'color_base0'	=>	"#0B63F1",
	'width'			=>	350,
	'height'		=>	50,
	'close'			=>	"yes",
	'html'			=>	$mdl_temp,
	'article_id'			=>	$id,);

  return $box;

  return undef;
 }
}


1;
