sub BaseModul
{
#my $id=$form{id};
if ($form{set})
{
# $HTML_HEADER{BODY}{extract}="yes";
 $form{year1}-=1900;
 $form{mom1}--;

 my $starttime=timelocal(undef,$form{min1},$form{hour1},$form{day1},$form{mom1},$form{year1},undef,undef,undef);
 
 if (defined $form{id})
 {
  my $db_micro = $dbh->Query("
  	SELECT ID,fullname 
	FROM photogallery_cathegory 
	WHERE ID='$form{id}' 
	LIMIT 1");
  my @db_micro_line=$db_micro->FetchRow();
  
#  my $fullname_old=$db_micro_line[0];
#  if (not $fullname_old=~s|/.*?$||){$fullname_old=~s|.*?$||;}
#  my $fullname_new=$fullname_old."/".$form{tinyname};
#  $fullname_new=~s|^/||g;

#  my @cat=split('',$db_micro_line[0]);
  $db_micro_line[1]=~s|^/||;
  my @fullname_old=split('/',$db_micro_line[1]);
  my @fullname_new=@fullname_old;
  while (length($db_micro_line[0])<@fullname_new){pop @fullname_new;}
  
  $fullname_new[-1]=$form{tinyname};
  my $fullname_new_w=join "/",@fullname_new;  
  
  $dbh->Query("UPDATE photogallery_cathegory SET fullname='$fullname_new_w',tinyname='$form{tinyname}',starttime='$starttime',about='$form{about}' WHERE ID='$form{id}' LIMIT 1");

	my $db_micro = $dbh->Query("
		SELECT ID,fullname,tinyname,starttime,IDaspic,about,active
		FROM photogallery_cathegory
		WHERE ID LIKE '$form{id}%'
		ORDER BY ID");
	while (my @db_micro_line=$db_micro->FetchRow())
	{
	 my @cat0=split('',$db_micro_line[0]);
	 my @fullname_old0=split('/',$db_micro_line[1]);
	 my $loop;
	 foreach (@fullname_new)
	 {
	  if ($_ ne $fullname_old0[$loop])
	  {
	   $fullname_old0[$loop]=$_;
	  }
	  $loop++;
	 }
     my $fullname_old0_w=join "/",@fullname_old0;
	 $dbh->Query("UPDATE photogallery_cathegory SET fullname='$fullname_old0_w' WHERE ID='$db_micro_line[0]' LIMIT 1");
	}

  # TOTO BUDE TREBA ZMAZAT!!!!!!!!
  # !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
#  my $cat_w=$db_micro_line[0]." ";
#  my $cat_s;
#  while (($cat_w)&&($cat_w=~s|.?$||))
#  {$cat_s.=" OR ID='$cat_w'";}
#  $cat_s=~s|^ OR ||g;$cat_s=~s| OR ID=''$||g;
#  my @cat_select;
#  my $cat_limit=length($db_micro_line[0]);
#  my $db_micro1 = $dbh->Query("
# 	SELECT ID,tinyname
#	FROM photogallery_cathegory
#	WHERE $cat_s LIMIT $cat_limit");
#  while (my @db_micro1_line=$db_micro1->FetchRow())
#  {
#   my $pos=length($db_micro1_line[0]);
#   $cat_select[$pos-1]=$db_micro1_line[1];
#  }
#  $cat_w=join "/",@cat_select;
#  if ($cat_w ne $db_micro_line[1])
#  {$dbh->Query("UPDATE photogallery_cathegory SET fullname='$cat_w' WHERE ID='$db_micro_line[0]' LIMIT 1");}
  # !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

#	}



 }
 else
 {
 }
 return "\n<script>\nparent.document.frames['frm_base'].location.reload();\n</script>";
}
else
{
 $HTML_HEADER{BODY}{extract}="yes";
 $HTML_HEADER{BODY}{onunload}="parent.box_loading.style.display='block';";

 $db_micro = $dbh->Query("SELECT ID,fullname,tinyname,starttime,about FROM photogallery_cathegory WHERE ID='$form{id}' LIMIT 1");
 if (@db_micro_line=$db_micro->FetchRow())
 {
  (undef,$minR1,$hourR1,$mdayR1,$momR1,$yearR1,undef,undef,undef) = localtime($db_micro_line[3]);
 }
 else
 {
  (undef,$minR1,$hourR1,$mdayR1,$momR1,$yearR1,undef,undef,undef) = localtime($current_time);
 }
 $momR1++;$yearR1=$yearR1+1900;
 
 my $mdl_temp=<<"HEADER";
<table width=100% cellspacing=0 cellpadding=0 border=0><tr><td drag_here>
<form name="$form{type}\_$form{id}"  
action="core.pl?type=$form{type}&id=$form{id}&set=yes" target="frm_micro" method="POST">
</td><td width=100% style="FONT:10px Verdana;">
HEADER


 $mdl_temp.="<table width=100% cellspacing=2 cellpadding=0 border=0><tr><td width=50%></td>";
 
 my $width0=30-12;
 my $width1=50-12;
 
 my $mdl_micro;
 for (my $i=1;$i<=31;$i++)
 {
  $mdl_micro.="<div onclick=\"this.parentElement.parentElement.all['VALUE'].value='$i';\">&nbsp;$i</div>\n";
 }
 $mdl_temp.="<td>".&select_create(
 	'name'		=>	"day1",
	'value'		=>	$mdayR1,
	'maxlength'	=>	30,
	'width'		=>	$width0,
	'width1'	=>	50,
	'select'	=>	$mdl_micro
 )."</td>";
 
 
 my $mdl_micro;
 @mesiac=("january","february","march","april","may","june","july","august","september","october","november","december");
 for (my $i=1;$i<=12;$i++)
 {
  $mdl_micro.="<div onclick=\"this.parentElement.parentElement.all['VALUE'].value='$i';\">&nbsp;$i-$mesiac[$i-1]</div>\n";
 }
 $mdl_temp.="<td>".&select_create(
 	'name'		=>	"mom1",
	'value'		=>	$momR1,
	'maxlength'	=>	30,
	'width'		=>	$width0,
	'width1'	=>	90,
	'select'	=>	$mdl_micro
 )."</td>";
 
 
 
 my $mdl_micro;
 for (my $i=2000;$i<=2050;$i++)
 {
  $mdl_micro.="<div onclick=\"this.parentElement.parentElement.all['VALUE'].value='$i';\">&nbsp;$i</div>\n";
 }
 $mdl_temp.="<td>".&select_create(
 	'name'		=>	"year1",
	'value'		=>	$yearR1,
	'maxlength'	=>	30,
	'width'		=>	$width1,
	'width1'	=>	50,
	'select'	=>	$mdl_micro
 )."</td>"; 
 
 
 $mdl_temp.="<td>&nbsp;</td>";
 
 
  my $mdl_micro;
 for (my $i=0;$i<=23;$i++)
 {
  $mdl_micro.="<div onclick=\"this.parentElement.parentElement.all['VALUE'].value='$i';\">&nbsp;$i</div>\n";
 }
 $mdl_temp.="<td>".&select_create(
 	'name'		=>	"hour1",
	'value'		=>	$hourR1,
	'maxlength'	=>	30,
	'width'		=>	$width0,
	'width1'	=>	50,
	'select'	=>	$mdl_micro
 )."</td>"; 
 
  $mdl_temp.="<td>:</td>";
 
  my $mdl_micro;
 for (my $i=0;$i<=55;$i=$i+5)
 {
  $mdl_micro.="<div onclick=\"this.parentElement.parentElement.all['VALUE'].value='$i';\">&nbsp;$i</div>\n";
 }
 $mdl_temp.="<td>".&select_create(
 	'name'		=>	"min1",
	'value'		=>	$minR1,
	'maxlength'	=>	30,
	'width'		=>	$width0,
	'width1'	=>	50,
	'select'	=>	$mdl_micro
 )."</td>"; 
 
 $mdl_temp.="<td width=50%></td></tr></table>";


  
 $mdl_temp.=<<"HEADER";


<input type=text name=tinyname value="$db_micro_line[2]" class=input0 style="width:250px;" maxlength=20><BR>

<input type=text name=about value="$db_micro_line[4]" class=input0 style="width:250px;" maxlength=200><BR>
		
<table height=16 width=100% cellspacing=0 cellpadding=0 border=0 background="$tom::H_media/grf/admin/win_top_0_back.gif"><tr><td width=50% align=right><img src="$tom::H_media/grf/admin/win_top_0_del.gif" border=0><BR></td><td><center><input type=submit drag_here value="Save!" class=btn0 onclick="box_erase2();"></center></td><td align=left width=50%><img src="$tom::H_media/grf/admin/win_top_0_del.gif" border=0><BR></td></tr></table>	
	
HEADER
 
 
 $mdl_temp.="</td><td></form></td></tr></table>";
 
 my $box=&box_create2("Edit category",
	'color_base0'	=>	"#0B63F1",
	'width'			=>	200,
	'height'		=>	50,	
	'close'			=>	"yes",
	'html'			=>	$mdl_temp);

 return $box;
 
 return undef;
}
}


1;
