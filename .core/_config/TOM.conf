#!/usr/bin/perl
package TOM;
use strict;
use warnings;

$TOM::core_name="Cyclone";
$TOM::core_version="3.0-rc1";
# pokial sa niekde bude Cyclone3 hlasit pod buildom '????????'
# znamena to ze sa nenatahuje dobre kniznica TOM::rev, alebo
# nieco zlyhalo pri jej pouziti
$TOM::core_build="????????";
$TOM::core_revision="?";

# cas spustenia daneho engine
$TOM::time_start=time;

# maximalny pocet vykonatelnych requestov na jeden proces
$TOM::max_count=1000;
$tom::count=0;
# maximalny pocet sekund ktory moze byt fcgi process v pamati
$TOM::max_time=(60*60)*1; # 1h

# timeout in seconds when waiting to accept FCGI request
$TOM::fcgi_timeout=300;


%TOM::DB=
(
	'main'	=>
	{
		host	=>"localhost",
		user	=>"TOM",
		pass	=>"",
	}
);

$TOM::DB{'stats'}=$TOM::DB{'main'};
$TOM::DB{'sys'}=$TOM::DB{'main'};

=head1 ALARM CONFIGURATION
#
# $ALRM: Sets the limit (in seconds) for the script execution time.
# Default is 5 but lower values are NOT recommended !
# maximalny cas vykonania jedneho requestu.
# v pripade prekrocenia alarmu tomahawk vygeneruje HTML stranku
# s chybovou hlaskou, fcgi skript vsak pokracuje v dalsom cykle,
# neukoncuje sa!!!
# alarm je automaticky ignorovany v pripade vykonavania modulov
# pre tie je nastaveny limit $ALRM_mdl
#
# je nutne brat v uvahu to ze sekundaz nieje presne ale je vzdy
# +- cca 1 sekunda. ide o to ze meranie sekundaze moze byt spustene
# v okamziku ked uz konci nulta sekunda a zacina prva, preto je
# nastavenie alarmu pre 1 sekundu vlastne nastavenie pre 0-1 sekundu.
# neodporuca sa nikdy nastavovat alarm pre jednu sekundu!!!
=cut
$TOM::ALRM=20;
$TOM::ALRM_mdl=60;
$TOM::ALRM_smdl=60;
$TOM::ALRM_change=0; #allowing for ALRM change :)
$CRON::ALRM_mdl=600;

=head1 CONFIGURE Z TABULKY _CONFIG
#
# $_config_load: Shall the VAR values be loaded? 1 - Yes 0 - No. Default is 0
# pozor na hodnoty vkladane v tabulke _config do VAR, lebo tieto priamo prepisuju
# hodnoty uz existujucich premennych!!! a vykonava sa nad nimi priamo eval!
#
# $tom::_config_lasttime obsahuje udaj o poslednom natiahnuty premennych
#
# $_config_loadtime: How frequent will the update be (in seconds).
# Default is 60*30 that is 30 minutes
#
# $_config_mirror: Shall the VAR variables be mirrores into a file that is
# loaded on start? Default is 0
=cut
$TOM::_config_load=0;
$TOM::_config_loadtime= 60*30;
#our $_config_mirror=0; # docasne vypnute



=head1 CONTACT CONFIGURATION



=cut

$TOM::contact{'from'}="cyclone3\@localhost"; # adresa pouzivana na odosielanie posty

$TOM::contact{'TOM'}="roman.fordinal\@comsultia.com"; # zodpovedny za system Cyclone3
$TOM::contact{'TOM_farm'}=$TOM::contact{'TOM'}; # zodpovedny za Cyclone3 na danej farme

$TOM::contact{'TECH_manager'}="frlicka\@webcom.sk"; # zodpovedni za process
$TOM::contact{'TECH_farm'}=$TOM::contact{'TECH_farm'}; # zodpovedni za konkretnu farmu
$TOM::contact{'TECH'}=$TOM::contact{'TECH_farm'}; # zodpovedni za domenu ( vyplna sa v local.conf )

$TOM::contact{'TECH_list'}="tech\@webcom.sk";
$TOM::contact{'TECH_list_farm'}=$TOM::contact{'TECH_list'};

$TOM::contact{'WEB_manager'}="ferencey\@webcom.sk";
$TOM::contact{'WEB_farm'}=$TOM::contact{'WEB_manager'};
$TOM::contact{'WEB'}=$TOM::contact{'WEB_farm'};

$TOM::contact{'WEB_list'}="web\@webcom.sk";
$TOM::contact{'WEB_list_farm'}=$TOM::contact{'WEB_list'};

$TOM::contact{'DEV_manager'}="roman.fordinal\@comsultia.com";
$TOM::contact{'DEV_farm'}=$TOM::contact{'DEV_manager'};
$TOM::contact{'DEV'}=$TOM::contact{'DEV_farm'};

$TOM::contact{'DEV_list'}="cyclone3\@lists.comsultia.com"; # Cyclone3 developers maillist
$TOM::contact{'DEV_list_farm'}=$TOM::contact{'DEV_list'};

$TOM::contact{'support'}="support\@webcom.sk"; # default email adresa na support requesty


=head1 TOMAHAWK INTERNATIONALIZATION
#
# $LNG: This is the default language for Tomahawk. Should be "en"
# (English).
# $LNG_cp_default: Default codepage. Should be "UTF-8".
# %LNG_cp: Table containing language codes and their ALTERNATE codepages.
# toto pole obsahuje vsetky zname languages tomahawku a tiez pouzitelne
# ako default pre kazdy language sa pouziva codepage $LNG_cp_default
# iba v pripade ze browser dany codepage nepodporuje prejde k presmerovaniu
# na hodnotu v tomto poli.
#
# $LNG_search: Shall TOM search for avaiable laguage in module? 1 - Yes 0 - No.
# Will search in: $tom::lng , $tom::LNG and $TOM::LNG (in order).
=cut
$TOM::LNG="en";
$TOM::LNG_cp_default="UTF-8";
%TOM::LNG_cp=(
	en	=>	"ISO-8859-1",
	sk	=>	"ISO-8859-2",
	cz	=>	"ISO-8859-2",
#	de	=>	"",
#	hu	=>	"",
#	ru	=>	"",
#	jp	=>	"",
	);
$TOM::LNG_search=0;
$TOM::LNG_autodetect=0;
@TOM::LNG_accept=("en");
$TOM::LNG_permanent=0;

=head1 DEFAULT SYSTEM DESIGN (GRAPHICS)
# $H_grf: URL to the directory containing default design. ("http://...." format)
=cut
#$TOM::H_grf="http://media.webcom.sk/grf/TOM3";
$TOM::H_grf="http://media.webcom.sk/grf/Cyclone3";

=head1 CACHE CONFIG

=cut
$TOM::CACHE=1;
$TOM::CACHE_time=600; # default cache time
$TOM::CACHE_time_min=10;		# min cache time if optimization
$TOM::CACHE_time_max=604800;	# max time of cache if optimization

=head1 LOGGING CONFIGURATION (FOR DEBUGING PURPOSES)
# $DEBUG: Shall the system do logging. 1 - Yes 0 - No. Default 0
# defaultne Tomahawk nenatahuje ziadne kniznice potrebne k debugu
# pri nastaveni hodnoty 1 sa natiahne pri novom spusteni (nie requeste)
# kniznica pre debug. pripade 0 su dalsie hodnoty irelevatne vzhladom
# k zapisu vysledkov i ked mozu vykonavat backgroundovu cinnost
#
# $DEBUG_mdl: Shall the load of modules do logging. 1 - Yes 0 - No. Default 0
#
# $DEBUG_log_file: Depth of logging
# 0 - only start of request
# 1 - Basic logging for start and end events. (BASIC)
# 2-5 - Connection, Cookie and basic non-moodule logging. (MEDIUM)
# 5-7 - Accessed modules are logged. ()
# 8-9 - Module dependent logging. (MAXIMAL) WARRANTY!
# navyssi depth predstavuje najvyssie zatazenie a tiez "haldu"
# smetia v logoch.
#
# $DEBUG_log_file_frag: Log file fragmentation.
# 0 logs are fragmented by days
# 1 logs are fragmented by hours
=cut
$TOM::DEBUG=1;

$TOM::DEBUG_benchmark=1;

#our $DEBUG_mdl=0;
$TOM::DEBUG_mdl_old=86400; # po akom case znova debugovat
$TOM::DEBUG_mdl_max=86400; # aky cas debugovat?

# tento zaznam je uz neaktualny
#$TOM::DEBUG_type=0; # zaznamenavat informacie o jednotlivych typeckach

$TOM::DEBUG_cache=1; # debugove info o vyuzivani cache
$TOM::DEBUG_cache_old=86400*7*5; # po akom case debugovat cache od poslednej optimalizacie
				# (zapisuje do logu informaciu o tom ktory cache je ako
				#  vyuzity a za dobu existencie kolko bolo vykonani)


# nastavenia tykajuce sa podmienok po debuggingu na optimalizaciu cronom
$TOM::DEBUG_cache_min=1000/10; # minimalny pocet zobrazeni na optimalizaciu
$TOM::DEBUG_cache_mintime=86400/6; # minimalny cas vyuzity modulmi po ktorom optimalizovat
$TOM::DEBUG_cache_minovertime=86400*3; # minimalny cas po ktorom optimalizovat

#our $DEBUG_cache_opt=0; # defaultne nerobim optimalizaciu cache (fcgi zmeni na 1)
$TOM::DEBUG_cache_optim=50; # nasobok pre optimalizaciu
$TOM::DEBUG_cache_optimtime=60; # chcem usetrit 60 sekund;

# premenne _config sa cachuju
$TOM::var_cache=1;
$TOM::var_loadtime=60*30; # default 30 min
$TOM::DEBUG_var_cache=1; # debug vyuzitia jednotlivych premmennych v tbl _config

# systemovy tom3 log
$TOM::DEBUG_log_file=0;
$TOM::DEBUG_log_file_frag=0; # bez fragmentacie

# log aplikacii default
$TOM::DEBUG_log_mdl_file=0;
# log aplikacii defined
%TOM::DEBUG_log_app=	(
	'300'		=>	0,
	'400'		=>	0,
			);

# nastavenie typov logov
%TOM::DEBUG_log_type=(
	'deprecated' => { 'max_days' => 31 },
	'obsolete' => { 'max_days' => 31 },
	'eshop' => { 'max_days' => 31*6 },
);


=head1 POSIELANIE ERROROV
=cut
$TOM::ERROR_email=1;
$TOM::ERROR_module_email=1;
$TOM::ERROR_page_email=1;
$TOM::ERROR_email_maxlasttime=60*5; # poslat tu istu hlasku maximalne raz za X sec
# zoznam skupin z %TOM::contact ktorym posielat defaultne errory
@TOM::ERROR_email_send=(
	"TOM",
	"WEB",
	"DEV",
	"TECH");
# zoznam skupin z %TOM::contact ktorym posielat summary errorov defaultne
@TOM::ERROR_email_summary_send=(
	"TOM",
	"TOM_farm",
	"manager",
	"WEB_farm",
	"DEV_farm",
	"TECH_farm");
$TOM::smtp_host='localhost';
$TOM::smtp_user='';
$TOM::smtp_pass='';
#our $ERROR_log_email=1;

=head1 STAT CONFIGURATION
# $STAT: default statistic
=cut
$TOM::STAT=1; # a110

=head1 TYPES CONFIGURATION
# $type_pre: Module preprocessing. 1 - Yes 0 - No. Default is 0
# $type_post: Module postprocessing. 1 - Yes 0 - No. Default is 0.
# moduly ktore maju byt preprocesorovane a post... su ulozene vo
# var premennych v tabulke _config pod type_pre a type_post v cml
# tvare.
#
# $type_code: kodovanie typeciek do hashu. Default is 1; (secure)
=cut
$TOM::type_pre=0;
$TOM::type_post=0;
$TOM::type_code=1;

=head1 DATABASE CONFIGURATION
# $DB_host: Database host URL. Default is "localhost"
# $DB_name_TOM: Central database name. Primary used by Cyclone admin.
# $DB_name_STAT: Database for statistics.
# $DB_name_USRM: Database for User Management.
# $DB_user: !!! Database login !!!
# $DB_pass: !!! Database password !!!
# tieto name tabuliek su vynimkou. ostatne informacie o tom kde sa
# nachadzaju napriklad tabulky aplikacie 400 su ulozene vo var
# premennej db_400 v tabulke _config
=cut

# APP database (historicke dovody)
$TOM::DB_host="localhost"; # TODO: [Aben] Odstranit spetnu kompatibilitu s $TOM::DB_host (DEPRECATED)
#our $DB_user="TOM";
#our $DB_pass="kulume";

$TOM::DB_name_TOM="TOM"; # TODO: [Aben] $TOM::DB_name_TOM co najskor vyhodit (DEPRECATED)
$TOM::DB_name_STAT=$TOM::DB_name_TOM;
$TOM::DB_name_USRM=$TOM::DB_name_TOM;


# na ktore databazy sa bude publisher pri starte connectovat
@TOM::DB_pub_connect=('main','sys');

=head1
# >>>> LAYERS CONFIGURATION
# $LAYERS: Shall TOM use layers. 1 - Yes 0 - No. Default 0
# oznacuje to ci ma byt vobec natiahnuta kniznica. 0 znamena nie.
=cut
$TOM::LAYERS=0;

####################################
# NEW
####################################

$pub::DOC="XHTML";
$pub::engine_disabling=1; # povolenie zamedzenie pristupu k stranke pokial nesplnuje podmienky


$tom::type_codes{root}="btr38947sdfa"; # historicke dovody
# pouzivane kdekolvek kde sa nieco koduje nejakym klucom
# toto je len default pre domeny
%tom::code_keys=
(
	'root'		=>
	{
		key		=>	"btr38947sdfa",
		notuse	=>	1,
	},
	
	'root2'		=>
	{
		key		=>	"\x01\x05\x08\x03\x07\x08\x02\x01\x05\x04\x01\x06\x05\x05\x06\x01\x06\x05",
		notuse	=>	1,
	},
	
	'A1'		=>
	{
		key		=>	"\x04\x01\x06\x02\x01\x01\x08\x01\x06\x05\x05\x06\x05\x08\x03\x05\x05\x07",
		notuse	=>	1,
	},
	'A2'		=>
	{
		key		=>	"\x02\x01\x01\x05\x01\x06\x05\x06\x07\x05\x08\x03\x05\x04\x01\x06\x05\x08",
#		notuse	=>	1,
	},
	'A3'		=>
	{
		key		=>	"\x07\x05\x06\x02\x05\x05\x05\x08\x01\x06\x08\x03\x01\x01\x05\x04\x01\x06",
#		notuse	=>	1,
	},
	'A4'		=>
	{
		key		=>	"sdfuowelasjdfoasfduweprqwerdljsadfasop",
#		notuse	=>	1,
	},
);


$tom::code_key_root='root2';

$tom::rewrite=0;
$tom::rewrite_301=0;

# DEFAULT IP-cky pre exclude zo statistik
%TOM::a110_IP_exclude=(
	'82.119.103.193' => 1, # chello comsultia office
);

# DOPLNUJUCE BLBINKY

$main::request_code="00000000";
%tom::type_c=();

# END
1;# DO NOT CHANGE !
