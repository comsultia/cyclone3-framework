#!/usr/bin/perl
# USE UTF-8 !!!
package Tomahawk::module;
use open ':utf8', ':std';
use if $] < 5.018, 'encoding','utf8';
use utf8;
use strict;


use App::210::_init;
use App::900::_init;


sub execute
{
	my %env=@_;
	my %env_out;
	
	Tomahawk::GetTpl('env' => \%env) || return undef;
	
	my $non_recursive = 0;
	if ($env{'a210.recurse_notfound'})
	{
		$non_recursive = 1;
		delete $env{'a210.recurse_notfound'};
	}
	
	my $job = call job('a900-banner_list',{
		%env,
		'a210.recurse_none' => $non_recursive,
		'tpl_ext' => $TPL
	});
	
	if ($job->{'rows'})
	{
		$TPL->{'variables'}{'rows'} = $job->{'rows'};
		$TPL->{'variables'}{'items'} = $job->{'items'};
		$env_out{'entity'} = $job->{'entity'};
	}
	else
	{
		if ($non_recursive)
		{
			main::_log('no banner found for this node. searching recursively...');
			$job = call job('a900-banner_list',{
				%env,
				'tpl_ext' => $TPL
			});
			
			if ($job->{'rows'})
			{
				$TPL->{'variables'}{'rows'} = $job->{'rows'};
				$TPL->{'variables'}{'items'} = $job->{'items'};
				$env_out{'entity'} = $job->{'entity'};
			}
		}
	}
	
	return 1,%env_out;
}

1;
