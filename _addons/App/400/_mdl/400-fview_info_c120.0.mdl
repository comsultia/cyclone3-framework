#!/usr/bin/perl
# USE UTF-8 !!!
package Tomahawk::module;
use open ':utf8', ':std';
use encoding 'utf8';
use utf8;
use strict;
=head1 NAME
fview

=head1 HEAD_VERSION_BUILD
1.030701

=head1 DESCRIPTION
full view clanku s obrazkami a inymi mediami

=head1 XMLDESCRIPTION

<DESCRIPTION>

        <value id="preview" value="1" />
        <value id="output" value="xsgn" />

	<input id="-xsgn" value="varchar(20)">potrebujem design</input>
	<input id="a_*" value="text">vstup zo smdl</input>

</DESCRIPTION>


=head1 CHANGES
build 030703 - Aben
        *) pridanie fcie Tomahawk::utils::datetime::ctodatetime
build 030701 - Aben
        *) FIRST MAKE

=head1 WARNINGS & BUGS
        *) chyba este vela medii
=cut

sub execute
{
 my %env=@_;
 Tomahawk::GetXSGN(-convertvars=>1) || return undef; # NATIAHNEM XML DESIGN

 use Utils::datetime; # pouzijem kniznicu pre pracu s casom a datumom


 $env{db_120}=Tomahawk::Getmdlvar("120","db") unless $env{db_120};
 $env{db_120}=$TOM::DB_name unless $env{db_120};

 Tomahawk::debug::log(5,"start module");



 my $db0=$main::DBH->Query("
	SELECT
		IDcategory,fullname,nickname
	FROM $env{db_120}.a120
	WHERE 	ID='$env{a_IDauthor}'
		OR ID='$env{a_IDeditor}'
	LIMIT 2");

 while (my @db0_line=$db0->FetchRow())
 {
   $XSGN{TMP}=~s|<%AUTHOR%>|$db0_line[1]|g if $db0_line[0] eq "0";
   $XSGN{TMP}=~s|<%EDITOR%>|$db0_line[1]|g if $db0_line[0] eq "1";
 }


 my %env0=Utils::datetime::ctodatetime($env{a_starttime},format=>1); # zkonvertujem cas do hashu a zformatujem
 $XSGN{TMP}=~s|<%START_TIME%>|$env0{mday}.$env0{mom}.$env0{year} $env0{hour}:$env0{min}:$env0{sec}|g;
 my %env0=Utils::datetime::ctodatetime($env{a_changetime},format=>1);
 $XSGN{TMP}=~s|<%CHANGE_TIME%>|$env0{mday}.$env0{mom}.$env0{year} $env0{hour}:$env0{min}:$env0{sec}|g;
 $XSGN{TMP}=~s|<%VISITS%>|$env{a_visits}|g;
 $XSGN{TMP}=~s|<%VOTES_INDEX%>|$env{a_votes_index}|g;
 $XSGN{TMP}=~s|<%VOTES%>|$env{a_votes}|g;
 $XSGN{TMP}=~s|<%VOTES_VALUE%>|$env{a_votes_value}|g;



 # SPRACOVANIE PHOTOS
 # nacitam photos

#  my $var;foreach (keys %env0)
#  {$var.=" ".$_."=\"".$env0{$_}."\"";}

#  $XSGN{NULL}=~s|<%VAR%>|$var|;

#  $env{a_full}=~s|<!TMP!>|$XSGN{NULL}|;


  #$count++;
# }

 $XSGN{TMP}=~s|<%FULL%>|$env{a_full}|g;

 return 1}

1;












